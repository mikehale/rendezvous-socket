#!/usr/bin/env ruby

lib = File.expand_path('../../lib', __FILE__)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)
require 'rendezvous/socket'

$DEBUG = true if ENV['DEBUG']

socket = Rendezvous::Socket.new(ENV['RENDEZVOUS_URL'])
lport, _laddr, _rport, _raddr = socket.get_peer_endpoint
s, _addrinfo, _type = socket.open
s.puts Socket.gethostname
puts s.gets

exec "/usr/sbin/sshd", "-d", "-p", lport.to_s, "-f", "./sshd/sshd_config"
